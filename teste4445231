def organize_dataframe(df):
    # Ordena o DataFrame primeiro pela coluna 'line' e depois pela coluna 'type'
    df = df.sort_values(by=['line', 'type'])

    # Inicia a lista para armazenar os grupos processados
    result_list = []

    # Para cada grupo de 'register_id', vamos organizar os tipos conforme as regras
    for _, group in df.groupby('register_id'):
        # Mantém o tipo 'communication_letter' apenas uma vez (o último)
        group_without_comm_letter = group[group['type'] != 'communication_letter']
        group_with_comm_letter = group[group['type'] == 'communication_letter'].drop_duplicates(subset=['file'], keep='last')
        
        # Junta os dois grupos
        group_final = pd.concat([group_without_comm_letter, group_with_comm_letter])

        # Adiciona o grupo final à lista de resultados
        result_list.append(group_final)

    # Concatena todos os grupos organizados e retorna o DataFrame final
    return pd.concat(result_list).reset_index(drop=True)
